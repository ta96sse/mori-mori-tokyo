---
import type { Race } from "../types";

interface Props {
    race: Race;
    index: number;
}

const { race, index } = Astro.props;

// Determine category color based on category name
const getCategoryColor = (category: string) => {
    const c = category.toLowerCase();
    if (c.includes("adventure")) return "emerald";
    if (c.includes("trail")) return "teal"; // Changed from green to teal for distinctness or stick to HTML
    // HTML uses:
    // Running: gray-400 border-gray-500/30 bg-gray-500/10
    // Orienteering: ivyLight
    // Stage Race: rose
    // Adventure: emerald
    // Ultra Trail/Marathon: purple
    // Obstacle: orange/red?

    if (c.includes("running")) return "gray";
    if (c.includes("orienteering")) return "ivyLight"; // Special handling
    if (c.includes("stage")) return "rose";
    if (c.includes("ultra")) return "purple";
    if (c.includes("obstacle")) return "yellow";

    return "gray";
};

// Map colors to classes manually to ensure Tailwind picks them up,
// or use the exact classes seen in HTML.
// HTML for Running: text-gray-400 border-gray-500/30 bg-gray-500/10
// HTML for Orienteering: text-ivyLight border-ivyLight/30 bg-ivyLight/10
// HTML for Stage Race: text-rose-400 border-rose-500/30 bg-rose-500/10
// HTML for Adventure: text-emerald-400 border-emerald-500/30 bg-emerald-500/10
// HTML for Ultra: text-purple-400 border-purple-500/30 bg-purple-500/10

const getClasses = (category: string) => {
    const c = category.toLowerCase();
    if (c.includes("running"))
        return "text-gray-400 border-gray-500/30 bg-gray-500/10";
    if (c.includes("orienteering"))
        return "text-ivyLight border-ivyLight/30 bg-ivyLight/10";
    if (c.includes("stage"))
        return "text-rose-400 border-rose-500/30 bg-rose-500/10";
    if (c.includes("adventure"))
        return "text-emerald-400 border-emerald-500/30 bg-emerald-500/10";
    if (c.includes("ultra"))
        return "text-purple-400 border-purple-500/30 bg-purple-500/10";
    if (c.includes("obstacle"))
        return "text-yellow-400 border-yellow-500/30 bg-yellow-500/10";
    return "text-gray-400 border-gray-500/30 bg-gray-500/10";
};

const categoryClasses = getClasses(race.category);

const link = race.instagram || race.facebook || race.url;
---

<a
    href={link}
    target="_blank"
    rel="noopener"
    class="group relative bg-white/5 border border-white/20 p-8 rounded-3xl hover:border-ivyLight/50 transition-colors overflow-hidden reveal block"
    data-delay={index * 100}
>
    <div
        class="absolute inset-0 bg-gradient-to-br from-ivyLight/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"
    >
    </div>
    <div class="relative z-10">
        <div class="flex justify-between items-start mb-6">
            <span
                class={`px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest border ${categoryClasses}`}
            >
                {race.category}
            </span>
            <span class="text-ivyLight font-mono text-sm">{race.date}</span>
        </div>
        <h3
            class="font-display font-black text-2xl mb-4 leading-tight group-hover:text-ivyLight transition-colors"
        >
            {race.title}
        </h3>
        <div class="space-y-3 pt-4 border-t border-white/5">
            <div class="flex justify-between items-center text-xs">
                <span class="text-gray-400 uppercase tracking-wider"
                    >Location</span
                >
                <span class="font-bold text-white">{race.location}</span>
            </div>
            {
                race.members && (
                    <div class="flex justify-between items-baseline text-xs gap-2">
                        <span class="text-gray-400 uppercase tracking-wider flex-shrink-0">
                            Members
                        </span>
                        <span class="font-bold text-white text-right leading-relaxed">
                            {race.members}
                        </span>
                    </div>
                )
            }
        </div>
    </div>
</a>
